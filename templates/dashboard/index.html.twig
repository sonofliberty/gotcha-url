{% extends 'base.html.twig' %}

{% block title %}Dashboard - Gotcha URL{% endblock %}

{% block body %}
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body py-3">
        <form method="post" action="{{ path('app_create_link') }}">
            <div class="input-group mb-2">
                <span class="input-group-text bg-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="text-muted" viewBox="0 0 16 16">
                        <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
                        <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"/>
                    </svg>
                </span>
                <input type="url" class="form-control" name="target_url"
                       placeholder="Paste a URL to shorten..." required>
                <button type="submit" class="btn btn-primary">Shorten</button>
            </div>
            <input type="text" class="form-control form-control-sm" name="label"
                   placeholder="Label (optional)" maxlength="100">
        </form>
    </div>
</div>

{% if links|length == 0 %}
    <div class="text-center py-5 text-muted">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" class="mb-3 opacity-25" viewBox="0 0 16 16">
            <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1 1 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4 4 0 0 1-.128-1.287z"/>
            <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243z"/>
        </svg>
        <p class="mb-1 fw-medium">No links yet</p>
        <p class="small">Paste a URL above to create your first short link.</p>
    </div>
{% else %}
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Destination</th>
                    <th>Label</th>
                    <th>Short Link</th>
                    <th>Visits</th>
                    <th>Created</th>
                </tr>
            </thead>
            <tbody>
                {% for link in links %}
                    <tr style="cursor:pointer" onclick="window.location='{{ path('app_link_detail', {id: link.id}) }}'">
                        <td class="text-truncate" style="max-width: 350px;" title="{{ link.targetUrl }}">
                            {{ link.targetUrl }}
                        </td>
                        <td onclick="event.stopPropagation()">
                            <span class="label-display" data-link-id="{{ link.id }}" data-label="{{ link.label ?? '' }}">
                                {% if link.label %}
                                    {{ link.label }}
                                {% else %}
                                    <span class="text-muted fst-italic">+ label</span>
                                {% endif %}
                            </span>
                        </td>
                        <td class="text-nowrap">
                            <code class="me-1">{{ url('app_track', {slug: link.slug}) }}</code>
                            <button type="button" class="btn btn-sm btn-outline-secondary btn-copy"
                                    data-url="{{ url('app_track', {slug: link.slug}) }}"
                                    onclick="event.stopPropagation()" title="Copy short URL">Copy</button>
                        </td>
                        <td><span class="badge bg-info">{{ link.visitCount }}</span></td>
                        <td class="text-nowrap">
                            <time datetime="{{ link.createdAt|date('c') }}">{{ link.createdAt|date('M j, Y') }}</time>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if totalPages > 1 %}
        <nav class="mt-3">
            <ul class="pagination justify-content-center">
                <li class="page-item {{ currentPage <= 1 ? 'disabled' }}">
                    <a class="page-link" href="{{ path('app_dashboard', {page: currentPage - 1}) }}">Previous</a>
                </li>
                {% for p in 1..totalPages %}
                    <li class="page-item {{ p == currentPage ? 'active' }}">
                        <a class="page-link" href="{{ path('app_dashboard', {page: p}) }}">{{ p }}</a>
                    </li>
                {% endfor %}
                <li class="page-item {{ currentPage >= totalPages ? 'disabled' }}">
                    <a class="page-link" href="{{ path('app_dashboard', {page: currentPage + 1}) }}">Next</a>
                </li>
            </ul>
        </nav>
    {% endif %}
{% endif %}
{% endblock %}

